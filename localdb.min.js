/*
  localDB Â© 2012 Michael Donaldson
  Simple localStorage Database
  
  License: Creative Commons Attribution 3.0 (http://creativecommons.org/licenses/by/3.0/)
*/
function localdb(g){void 0===localStorage[g]&&(localStorage[g]=JSON.stringify({}));var b=JSON.parse(localStorage[g]),e=function(a){localStorage[g]=JSON.stringify(a);return!0},k={createTable:function(a){if(void 0===b[a])b[a]={totalrows:0,autoinc:1,rows:{}},e(b);else return console.log('A table with the name "'+a+'" already exists'),!1},dropTable:function(a){if(void 0!==b[a])delete b[a],e(b);else return console.log('A table with the name "'+a+'" could not be found'),!1},tableMeta:function(a){if(void 0!==
b[a])return{totalrows:b[a].totalrows,autoinc:b[a].autoinc};console.log('A table with the name "'+a+'" could not be found');return!1},insert:function(a,c){void 0===b[a]&&k.createTable(a);autoinc=b[a].autoinc;c.ID=autoinc;b[a].rows[autoinc]=c;b[a].autoinc+=1;b[a].totalrows+=1;e(b)},update:function(a,c,f){if(void 0!==b[a]){var d=b[a].rows;for(row in d)if(null!==d[row]){var l=0;for(i in f)b[a].rows[row][i]!=f[i]&&(l=1);if(0==l){for(i in c)b[a].rows[row][i]=c[i];e(b)}}}else return console.log('A table with the name "'+
a+'" could not be found'),!1},updateById:function(a,c,f){if(void 0!==b[a]){for(i in c)b[a].rows[f][i]=c[i];e(b)}else return console.log('A table with the name "'+a+'" could not be found'),!1},remove:function(a,c){if(void 0!==b[a]){var f=b[a].rows;for(row in f)if(null!=f[row]){var d=0;for(i in c)b[a].rows[row][i]!=c[i]&&(d=1);0==d&&(delete b[a].rows[row],e(b))}}else return console.log('A table with the name "'+a+'" could not be found'),!1},removeById:function(a,c){if(void 0!==b[a])if(null!==b[a].rows[c])delete b[a].rows[c],
e(b);else return console.log("The specified row could not be found"),!1;else return console.log('A table with the name "'+a+'" could not be found'),!1},find:function(a,c,f,d,e){e||(e="AND");if(void 0!==b[a]){var g=b[a].rows,j=[],h=1;for(p in c){h=0;break}if(0==h)for(row in g){h=0;if("AND"==e.toUpperCase())for(i in c)if(b[a].rows[row][i]==c[i])h=1;else{h=0;break}else if("OR"==e.toUpperCase())for(i in c)b[a].rows[row][i]==c[i]&&(h=1);1==h&&j.push(b[a].rows[row])}else for(row in g)j.push(b[a].rows[row]);
d?"number"!=typeof d&&(d=0):d=0;return"number"==typeof f?0<f?j.slice(d,f+d):j.slice(d):j}console.log('A table with the name "'+a+'" could not be found');return!1},findById:function(a,c){if(void 0!==b[a]){if(void 0!==b[a].rows[c])return b[a].rows[c];console.log("The requested record could not be found");return!1}console.log('A table with the name "'+a+'" could not be found');return!1},dbExists:function(a){return void 0!==localStorage[a]?!0:!1},tableExists:function(a){return void 0!==b[a]?!0:!1},exportData:function(a){if(a){if(void 0!==
b[a])return JSON.stringify(b[a]);console.log("Table not found");return!1}return JSON.stringify(b)}};return k};